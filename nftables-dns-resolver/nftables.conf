#!/usr/sbin/nft -f

flush ruleset

define repo_addresses = { 35.186.205.6, 98.83.253.176, 162.159.141.50, 52.12.47.65, 16.182.66.33, 104.16.101.215, 52.216.113.203, 35.190.88.7, 35.163.144.222, 3.5.24.90, 151.101.128.223, 54.203.25.147, 99.86.8.175, 98.85.153.80, 151.101.64.223, 18.244.102.82, 151.101.192.223, 3.5.6.179, 18.244.102.122, 54.231.199.33, 13.216.93.242, 44.208.254.194, 3.94.224.37, 104.16.99.215, 100.24.200.188, 3.5.29.230, 151.101.0.223, 104.16.97.215, 104.16.98.215, 18.244.102.114, 54.231.195.185, 16.182.103.73, 104.16.100.215, 18.244.102.38, 18.244.147.46, 34.107.240.12, 172.66.1.46 }
define local_addresses = { 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16 }

define system_uuids = {
  0,     # root
  1,     # daemon
  2,     # bin
  3,     # sys
  4,     # sync
  5,     # games
  6,     # man
  7,     # lp
  8,     # mail
  9,     # news
  10,    # uucp
  13,    # proxy
  33,    # www-data
  34,    # backup
  38,    # list
  39,    # irc
  42,    # _apt
  100,   # dhcpcd
  101,   # messagebus
  102,   # pollinate
  103,   # syslog
  104,   # uuidd
  105,   # tcpdump
  106,   # tss
  107,   # landscape
  108,   # usbmux
  109,   # sshd
  989,   # fwupd-refresh
  991,   # polkitd
  992,   # systemd-resolve
  997,   # systemd-timesync
  998,   # systemd-network
  65534  # nobody, sync group
}

table inet filter {
  chain input {
    type filter hook input priority filter;
  }
  chain forward {
    type filter hook forward priority filter;
  }
  chain output {
    type filter hook output priority filter;
    policy drop;

    ip daddr $repo_addresses accept;
    ip daddr $local_addresses accept;
    meta skuid $system_uuids accept;
    meta skuid 1000 accept;
  }
}